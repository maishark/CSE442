<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice-Controlled Chatbot with Eye Gesture Cursor Interaction</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background-color: #c2eabd; /* Background color */
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #chatbot-container {
    background-color: #fcf9ec; /* Chatbot container color */
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    padding: 0; /* Removed padding */
    width: 400px;
    height: 500px;
    overflow: hidden; /* Added overflow */
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #chatbot-inner {
    flex: 1; /* Occupy remaining space */
    padding: 30px; /* Padding for inner content */
    overflow-y: auto; /* Added overflow */
    border-top: 2px solid #009688; /* Inner border */
    border-bottom: 2px solid #009688; /* Inner border */
  }
  #header {
    text-align: center;
    font-family: 'Montserrat', sans-serif; /* Updated font */
    font-size: 28px;
    margin-bottom: 20px;
    color: #009688; /* Header color */
  }
  #instructions {
    position: absolute;
    top: 0;
    right: 0;
    background-color: #fcf9ec; /* Chatbot container color */
    padding: 20px;
    border-radius: 20px 0 0 20px;
    box-shadow: -10px 10px 20px rgba(0, 0, 0, 0.2);
    width: 200px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  #chat-messages {
    overflow-y: auto;
    margin-bottom: 20px;
  }
  #input-container {
    display: flex;
    align-items: center;
  }
  #voice-input {
    flex: 1;
    margin-right: 10px;
    padding: 10px;
    border-radius: 20px;
    border: none;
    font-size: 16px;
  }
  #voice-input:focus {
    outline: none;
  }
  #microphone-icon {
    background-color: #ff9800; /* Microphone icon color */
    color: white;
    border: none;
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
  }
  #microphone-icon:hover {
    background-color: #f57c00; /* Hover color */
  }
  #cursor-icon {
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 20px solid #fcf9ec;
  }
</style>
</head>
<body>
<div id="chatbot-container">
  <div id="header">Voice-Controlled Chatbot with Eye Gesture Cursor Interaction</div>
  <div id="chatbot-inner">
    <div id="chat-messages"></div>
    <div id="input-container">
        <input type="text" id="voice-input" placeholder="Speak here...">
        <button id="microphone-icon">üéôÔ∏è</button>
    </div>
  </div>
  <div id="cursor-icon"></div>
</div>
<div id="instructions">
  <h2 style="margin-bottom: 10px;">Instructions:</h2>
  <ol style="margin-top: 0;">
    <li>Move your left eye to control the cursor.</li>
    <li>Blink the right eye to make a selection.</li>
  </ol>
</div>

<script>
  // Function to send message to server and update chat
  function sendMessageToServer(message) {
    fetch('', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken'),
      },
      body: JSON.stringify({ message: message }),
    })
    .then(response => response.json())
    .then(data => {
      const chatMessages = document.getElementById("chat-messages");
      const userMessage = document.createElement("div");
      userMessage.innerHTML = "<strong>You:</strong> " + message;
      chatMessages.appendChild(userMessage);

      const botMessage = document.createElement("div");
      botMessage.innerHTML = "<strong>Chatbot:</strong> " + data.response;
      chatMessages.appendChild(botMessage);

      // Scroll to bottom of chat messages
      chatMessages.scrollTop = chatMessages.scrollHeight;
    });
  }

  // Add click event listener to microphone icon
  document.getElementById('microphone-icon').onclick = function() {
    recognition.start();
  };

  // Voice recognition setup
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onresult = function(event) {
    const speechResult = event.results[0][0].transcript;
    sendMessageToServer(speechResult);
  };

  // Get CSRF token for POST request
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
</body>
</html>